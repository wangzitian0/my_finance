---
# stop.yml - Stop local development environment
- name: Stop Development Environment  
  hosts: localhost
  connection: local
  gather_facts: yes
  tasks:
    - name: Stop Neo4j container
      shell: |
        if podman ps | grep -q "neo4j-finance"; then
          echo "Stopping Neo4j container..."
          podman stop neo4j-finance
        else
          echo "Neo4j container not running"
        fi
      register: neo4j_stop
      changed_when: "'Stopping' in neo4j_stop.stdout"

    - name: Stop Podman machine (optional - keeps it running for faster startup)
      shell: |
        echo "Keeping Podman machine running for faster future startups"
        echo "To fully stop: podman machine stop"
      register: podman_machine_info
      changed_when: false

    - name: Display stop status
      debug:
        msg: |
          ğŸ›‘ Development environment stopped!
          
          ğŸ“Š Status:
          - Neo4j container: Stopped
          - Podman machine: Still running (for faster restart)
          
          ğŸ”„ To restart:
          - `pixi run env-start`
          
          ğŸ› ï¸  To fully shutdown:
          - `podman machine stop` (if you want to free all resources)