# 系统架构设计

## 整体架构图

```
╔═══════════════╗
║  Web Frontend     ║
║  (手机友好)      ║
╚═══════╦════════╝
         │
╔═══════╦════════╗
║ Question/Answer API  ║
║   (问答接口)       ║
╚═══════╦════════╝
         │
╔═══════╦════════╗
║   Graph RAG Engine   ║
║  (检索增强生成)   ║
╚═══════╦════════╝
         │
    ┌────┼────┐
    │         │
┌───┬───── ┌──┬─────┐
│LLM│       │DCF│     │
│API│       │API│     │
└───┴───── └──┴─────┘
         │
╔═══════╦════════╗
║   Neo4j Graph DB    ║
║  (知识图谱存储)    ║
╚═══════╦════════╝
         │
╔═══════╦════════╗
║   Data Pipeline     ║
║  (数据清洗和校验)   ║
╚═══════╦════════╝
         │
┌───────┼──────────────────────────────┐
│        │                                        │
│ SEC    │ Yahoo    │ Analyst  │ S&P     │ News   │
│ Edgar  │ Finance  │ Reports  │ EPS     │ APIs   │
│        │          │          │ Data    │        │
└───────┴──────────┴──────────┴─────────┴────────┘
```

## 核心组件

### 1. 数据层 (Data Layer)
- **多源数据采集**: SEC Edgar, Yahoo Finance, 分析师报告, S&P EPS预期
- **数据校验**: 客观数据取频率高值，主观数据展示分布
- **存储**: Neo4j图数据库 + 原始文件存储

### 2. 计算层 (Computation Layer) 
- **DCF引擎**: 可配置参数的估值模型
- **敏感性分析**: 不同参数下的估值范围
- **中间结果缓存**: 预计算常用指标存入图中

### 3. 知识层 (Knowledge Layer)
- **Graph RAG**: 基于图结构的检索增强生成
- **语义检索**: 基于向量相似度的文档检索
- **结构化查询**: Cypher查询 + LLM生成

### 4. 服务层 (Service Layer)
- **LLM接口**: 支持本地/云端模型切换
- **问答API**: RESTful接口支持复杂查询
- **评估系统**: 用户反馈和质量评分

### 5. 应用层 (Application Layer)
- **Web界面**: 手机友好的问答界面
- **命令行工具**: 快速开发和测试
- **管理后台**: 数据状态监控和系统维护

## 技术选型

### 数据存储
- **Neo4j**: 图数据库，适合复杂关系查询
- **文件系统**: 原始 SEC 文件和日志存储

### 计算框架
- **Python**: 主要开发语言
- **neomodel**: Neo4j ORM
- **pandas/numpy**: 数据处理和计算

### LLM集成
- **本地模型**: Ollama + Mistral/Qwen
- **云端模型**: Claude API
- **向量数据库**: 适用于语义检索的嵌入存储

### Web技术栈
- **后端**: FastAPI/Flask
- **前端**: 轻量级框架（React/Vue）
- **部署**: Docker + Ansible

## 扩展性考虑

### 模块化设计
- **数据源插件**: 新数据源易于集成
- **LLM适配器**: 支持不同模型接口
- **计算引擎**: DCF之外的其他估值模型

### 性能优化
- **分层缓存**: 数据层/计算层/结果层缓存
- **异步处理**: 数据采集和复杂计算异步执行
- **数据分区**: 按时间/行业分区存储

---

*架构设计会随着实现进展进行调整和优化*