[project]
name = "my_finance"
version = "0.1.0"
description = "Graph RAG-powered DCF valuation system"
authors = ["Your Name <your.email@example.com>"]
channels = ["conda-forge"]
platforms = ["win-64", "linux-64", "osx-64", "osx-arm64"]

[dependencies]
# Core cross-platform dependencies
python = "3.12.*"
openjdk = "17.*"
git = "*"
# ansible and psutil are installed via pip in the 'setup-env' task

# Essential Python packages
pip = "*"
pyyaml = "*"
requests = "*"
beautifulsoup4 = "*"
pandas = "*"
numpy = "*"
matplotlib = "*"
seaborn = "*"
jupyter = "*"
black = "*"
isort = "*"
pylint = "*"
mypy = "*"
pytest = "*"
pytest-cov = "*"
python-dotenv = "*"
click = "*"
tqdm = "*"
lxml = "*"
# Neo4j Python driver (official driver for connecting to Neo4j)
neo4j-python-driver = "*"

[tasks]
# Core commands from CLAUDE.md
activate = "echo 'Pixi environment activated'"
build-m7 = "python manage.py build m7"
status = "python manage.py status"
run-job = "python run_job.py"

# Install additional packages via pip (cross-platform)  
install-extras = "pip install pipenv datasette neomodel yfinance secedgar"
install-graph-rag = "pip install 'numpy<2.0' 'torch>=2.4.0' 'safetensors>=0.4.5' sentence-transformers"

# Development tasks
format = { cmd = "black . --exclude='.pixi' && isort . --skip-glob='.pixi/*'", cwd = "." }
lint = "echo 'Lint: Using black and isort for code quality (pylint disabled due to dependency conflicts)' && black --check . --exclude='.pixi' && isort --check-only . --skip-glob='.pixi/*'"
lint-pylint = "pylint . || echo 'pylint skipped due to dependency conflicts'"
typecheck = "mypy ."
# Testing and coverage tasks
test = "pytest tests/ -v"
test-with-coverage = "pytest tests/ --cov=. --cov-config=.coveragerc --cov-report=xml --cov-report=html --cov-report=term-missing"
coverage-report = "coverage html && coverage xml"
coverage-check = "python scripts/check_coverage.py --threshold 25"

# User case testing tasks
test-strategy-analyst = "pytest tests/test_user_cases.py::TestStrategyAnalystWorkflow -v"
test-risk-manager = "pytest tests/test_user_cases.py::TestRiskManagerWorkflow -v"  
test-investment-manager = "pytest tests/test_user_cases.py::TestInvestmentManagerWorkflow -v"
test-all-user-cases = "pytest tests/test_user_cases.py -v"

# Test environment setup
setup-test-env = "python scripts/setup_test_environment.py"

# Metadata management tasks
metadata-list = "python scripts/manage_metadata.py list"
metadata-rebuild = "python scripts/manage_metadata.py rebuild"
metadata-index = "python scripts/manage_metadata.py index"
metadata-failures = "python scripts/manage_metadata.py failures"
metadata-cleanup = "python scripts/manage_metadata.py cleanup"
retry-failed = "python scripts/retry_failed.py"

# Strategy Engine tasks (NEW)
validate-strategy = "python strategy/validator.py"
generate-report = "python strategy/validator.py && echo 'Reports saved in data/reports/'"
backtest = "python -c 'from strategy.validator import StrategyValidator; v=StrategyValidator(); print(v._run_backtest())'"
benchmark = "python -c 'from strategy.validator import StrategyValidator; v=StrategyValidator(); print(v._compare_benchmarks())'"

# Graph RAG specific tasks
setup-graph-rag = "python setup_graph_rag.py"
demo-graph-rag = "python demo_graph_rag.py"
test-graph-rag = "python test_graph_rag.py"

# Git workflow optimization tasks
cleanup-branches = "python scripts/cleanup_merged_branches.py --interactive"
cleanup-branches-auto = "python scripts/cleanup_merged_branches.py --auto"
cleanup-branches-dry-run = "python scripts/cleanup_merged_branches.py --dry-run"
install-git-hooks = "python scripts/install_git_hooks.py"

# --- Environment Management (Ansible) ---
# Initial environment setup
setup-env = "pip install ansible psutil && ansible-playbook ansible/init.yml --ask-become-pass"
# Environment operations
env-start = "ansible-playbook ansible/start.yml"
env-stop = "ansible-playbook ansible/stop.yml" 
env-status = "python scripts/env_status.py"
env-reset = "ansible-playbook ansible/reset.yml"
# One-click shutdown all services
shutdown-all = "python scripts/shutdown_all.py"

# --- Development Operations (Pure Development) ---
# Core data operations remain in pixi

[environments]
default = { solve-group = "default" }
# The 'dev' environment currently inherits all dependencies from 'default'.
# If you need dev-specific dependencies, create a [feature.dev.dependencies] section.
dev = { solve-group = "default" }