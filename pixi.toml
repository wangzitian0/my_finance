[project]
name = "my_finance"
version = "0.1.0"
description = "Graph RAG-powered DCF valuation system"
authors = ["Your Name <your.email@example.com>"]
channels = ["conda-forge"]
platforms = ["win-64", "linux-64", "osx-64", "osx-arm64"]

[dependencies]
# Core cross-platform dependencies
python = "3.12.*"
openjdk = "17.*"
git = "*"
# ansible and psutil are installed via pip in the 'setup-env' task

# Essential Python packages
pip = "*"
pyyaml = "*"
requests = "*"
beautifulsoup4 = "*"
pandas = "*"
numpy = "*"
matplotlib = "*"
seaborn = "*"
jupyter = "*"
black = "*"
isort = "*"
pylint = "*"
mypy = "*"
pytest = "*"
pytest-cov = "*"
python-dotenv = "*"
click = "*"
tqdm = "*"
lxml = "*"
# Neo4j Python driver (official driver for connecting to Neo4j)
neo4j-python-driver = "*"

[tasks]
# Core commands from CLAUDE.md
activate = "echo 'Pixi environment activated'"
build-m7 = "python manage.py build m7"
status = "python manage.py status"
run-job = "python run_job.py"
setup-env = "pip install ansible psutil && ansible-playbook ansible/init.yml --ask-become-pass"

# Install additional packages via pip (cross-platform)
install-extras = "pip install pipenv datasette neomodel yfinance secedgar"

# Development tasks
format = { cmd = "black . && isort .", cwd = "." }
lint = "pylint ."
typecheck = "mypy ."
test = "pytest"
test-coverage = "pytest --cov"

# Environment checking
doctor = "python scripts/minikube_doctor.py"

# --- Minikube and Kubernetes Management ---
# Minikube cluster management
k8s-start = "minikube start --driver=docker --memory=4096 --cpus=2"
k8s-stop = "minikube stop"
k8s-status = "minikube status"
k8s-delete = "minikube delete"
k8s-dashboard = "minikube dashboard"
k8s-ip = "minikube ip"

# Service deployment and management
services-deploy = "kubectl apply -f k8s/"
services-delete = "kubectl delete -f k8s/"
services-status = "kubectl get pods,services"

# Neo4j specific commands
neo4j-logs = "kubectl logs -l app=neo4j -f"
neo4j-status = "kubectl get pods -l app=neo4j"
neo4j-restart = "kubectl rollout restart deployment/neo4j"
neo4j-connect = "echo 'Neo4j Web: http://'$(minikube ip)':30474' && echo 'Neo4j Bolt: bolt://'$(minikube ip)':30687' && echo 'Username: neo4j, Password: finance123'"

# Port forwarding for local access (alternative to NodePort)
neo4j-port-forward = "kubectl port-forward service/neo4j-service 7474:7474 7687:7687"

# Cleanup command
neo4j-remove = "kubectl delete -f k8s/neo4j.yaml && kubectl delete pvc neo4j-data-pvc neo4j-logs-pvc"

[environments]
default = { solve-group = "default" }
# The 'dev' environment currently inherits all dependencies from 'default'.
# If you need dev-specific dependencies, create a [feature.dev.dependencies] section.
dev = { solve-group = "default" }